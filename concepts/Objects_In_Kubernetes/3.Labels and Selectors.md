
# üè∑Ô∏è Labels and Selectors in Kubernetes

## ‚úÖ What are Labels?

- Labels are **key/value pairs** attached to Kubernetes objects (like Pods).
- Used to **organize**, **filter**, and **select subsets** of objects.
- **Do not imply any semantics** to the Kubernetes core system.
- Can be:
  - Added during object creation
  - Modified later at any time
- **Each label key must be unique** for a given object.

### Example:
```yaml
metadata:
  labels:
    key1: value1
    key2: value2
```

> ‚ö†Ô∏è Use **annotations** for non-identifying information (e.g., build info, contact, etc.).

---

## üß† Why Labels Matter? (Motivation)

- Map your **organizational structure** to system objects.
- Helpful in **multi-dimensional deployments**:
  - Multiple environments (dev, qa, prod)
  - Multiple versions (stable, canary)
  - Microservices per tier (frontend/backend/cache)

### Common Label Examples:
```yaml
"release": "stable" or "canary"
"environment": "dev", "qa", "production"
"tier": "frontend", "backend", "cache"
"partition": "customerA", "customerB"
"track": "daily", "weekly"
```

> Example: Label all backend pods in `production` with:
```yaml
labels:
  environment: production
  tier: backend
```

---

## üõ†Ô∏è Label Syntax & Character Set

### üîë Key:
- Can have a **prefix** (optional) and **name** (required)
- Format: `[prefix/]name`
- Prefix must be a **DNS subdomain** (max 253 chars), ending with `/`
  - e.g., `example.com/role`, `kubernetes.io/role`
- Name rules:
  - Max 63 characters
  - Start and end with alphanumeric
  - May contain: `-`, `_`, `.`, and alphanumerics

### üìå Value:
- Max 63 characters (can be empty)
- If not empty, must:
  - Start and end with alphanumeric
  - Can include: `-`, `_`, `.`

> Reserved prefixes: `kubernetes.io/` and `k8s.io/`

---

## üîç Label Selectors

Labels are used in **selectors** to filter and manage objects.

### 2 Types of Selectors:
#### 1. **Equality-Based** (`=`, `==`, `!=`)
- Match key with exact value or not equal
- Comma (`,`) acts as **AND**

#### Examples:
```bash
environment=production          # equality
tier!=frontend                  # inequality
environment=production,tier!=frontend
```

#### Use case:
```yaml
nodeSelector:
  accelerator: nvidia-tesla-p100
```

#### 2. **Set-Based** (`in`, `notin`, `exists`, `!`)
- More flexible, can match **sets of values** or **existence**

#### Examples:
```bash
environment in (production, qa)
tier notin (frontend, backend)
partition                     # exists
!partition                    # does not exist
```

> Equivalent:  
`environment=production` ‚Üí `environment in (production)`  
`tier!=frontend` ‚Üí `tier notin (frontend)`

---

## üîÑ Combining Selectors

You can **combine both selector types**:

```yaml
selector:
  matchLabels:
    component: redis
  matchExpressions:
    - { key: tier, operator: In, values: [cache] }
    - { key: environment, operator: NotIn, values: [dev] }
```

- `matchLabels`: simple key/value
- `matchExpressions`: advanced conditions
- All conditions must be **true (AND)**

---

## üì° Using Label Selectors in CLI

### Equality-based:
```bash
kubectl get pods -l environment=production,tier=frontend
```

### Set-based:
```bash
kubectl get pods -l 'environment in (production),tier in (frontend)'
kubectl get pods -l 'environment notin (dev),tier'
```

---

## üìö API Usage (LIST/WATCH)

Label selectors can filter LIST/WATCH operations in the API.

#### URL Query Example:
```http
GET /api/v1/pods?labelSelector=environment=production,tier=frontend
```

---

## üîó Label Selectors in Kubernetes Objects

Used in:
- **Services**
- **ReplicationControllers**
- **Deployments**
- **ReplicaSets**
- **Jobs**
- **DaemonSets**

### Example in Service:
```yaml
selector:
  component: redis
```

> Only equality-based selectors are allowed in older resources like **ReplicationControllers** and **Services**.

---

## üß© Label Use Case in Multi-tier App

Example: A Guestbook app with frontend and Redis backend

### Frontend Pod:
```yaml
labels:
  app: guestbook
  tier: frontend
```

### Redis Master Pod:
```yaml
labels:
  app: guestbook
  tier: backend
  role: master
```

### Redis Replica Pod:
```yaml
labels:
  app: guestbook
  tier: backend
  role: replica
```

### Command to View All Labels:
```bash
kubectl get pods -Lapp -Ltier -Lrole
```

---

## üö® Notes & Cautions

- Labels are **not unique** like names or UIDs ‚Äî multiple objects can share same label.
- Selectors act as **AND** logic only; **no OR** logic across different keys.
- Avoid overlapping selectors in the same namespace for objects like ReplicaSets.

---

## üìù Key Points to Remember

1. Labels are **key/value** pairs for organizing Kubernetes objects.
2. Use **selectors** to filter objects using labels.
3. **Equality-based** selectors use `=`, `==`, `!=`.
4. **Set-based** selectors use `in`, `notin`, `exists`, `!`.
5. Always use **AND logic**, not OR.
6. Apply **multiple labels** to objects for more granular control.
7. Use `kubectl get -l` to filter using selectors.
8. Prefer **set-based** selectors for more powerful querying.

---

