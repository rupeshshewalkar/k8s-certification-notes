
---

# üîê Enforcing Pod Security Standards in Kubernetes

This guide covers **best practices** for enforcing Pod Security in Kubernetes using the **Pod Security Admission (PSA) Controller** and third-party tools.

---

## üö® Using the Built-in Pod Security Admission Controller (PSA)

- **Introduced in Kubernetes v1.25 (stable)**
- Replaces the **deprecated PodSecurityPolicies (PSP)**
- Enforces security controls **at namespace level** using **labels**
- Helps ensure Pods follow one of the predefined **Pod Security Standards**:
  - `privileged`: No restrictions (for trusted workloads)
  - `baseline`: Some restrictions (sensible defaults)
  - `restricted`: Most secure (recommended for production)

---

## üìÇ Configure All Cluster Namespaces

> **Unlabeled namespaces = security gap**

- Every namespace must be evaluated and assigned an appropriate PodSecurity label.
- Analyze each namespace based on its workloads.
- Apply correct PodSecurity levels (restricted, baseline, privileged).

### üß∞ Example (Bulk Labeling)

If all namespaces have the same security needs (e.g., restricted), apply labels in bulk:

```bash
kubectl label --overwrite ns <namespace> \
  pod-security.kubernetes.io/enforce=restricted \
  pod-security.kubernetes.io/enforce-version=latest
```

---

## üîí Embrace the Principle of Least Privilege

> ‚ÄúGive minimum required permissions.‚Äù

- **Aim**: Every pod should meet the **`restricted`** policy.
- **Reality**: Some workloads may need elevated privileges.
- For such workloads:
  - Keep them in **separate namespaces**
  - Apply **strict access controls**
  - Document **why** they need special privileges
  - Try to **reduce privileges** where possible

### üß† Example:

If an app needs to run as root (e.g., a monitoring agent), place it in a namespace labeled `privileged`, but make sure access is tightly controlled.

---

## üéØ Adopt a Multi-Mode Strategy

PSA supports 3 **modes** to help enforce gradually:

| Mode     | Purpose                                                                 |
|----------|-------------------------------------------------------------------------|
| `enforce`| Blocks pod creation if not compliant                                    |
| `warn`   | Allows pod but shows warning to user (useful for developers)           |
| `audit`  | Logs non-compliant pod in audit logs (useful for security monitoring)  |

### ‚úÖ Best Practice:

Enable **audit** and **warn** modes **before** `enforce` to:

- Gain visibility into non-compliant Pods
- Prepare teams to fix issues before strict enforcement

### üß∞ Example:

```bash
kubectl label --overwrite ns <namespace> \
  pod-security.kubernetes.io/audit=restricted \
  pod-security.kubernetes.io/warn=restricted \
  pod-security.kubernetes.io/enforce=restricted
```

You can also use **different versions** for `audit`, `warn`, and `enforce` to test against future versions.

---

## üß© Third-Party Alternatives

If the built-in PSA controller doesn‚Äôt fit your needs, consider other tools:

| Tool          | Description |
|---------------|-------------|
| **Kubewarden** | Policy engine that uses WebAssembly (Wasm) for defining rules |
| **Kyverno**    | Policy-as-code tool purpose-built for Kubernetes |
| **OPA Gatekeeper** | Policy controller powered by Open Policy Agent (OPA) |

> üîç **Tip**: These tools provide more flexibility, such as custom policies or mutation.

### üí° Choosing Between PSA and Third-party:

- **PSA** = Simple, built-in, great for enforcing predefined standards.
- **Third-party tools** = Advanced use cases, custom logic, more control.
- Ensure you **trust the supply chain** of third-party tools.

---

## üìå Summary (Key Takeaways)

- Use the **Pod Security Admission Controller** to enforce security at the **namespace level**
- Apply **PodSecurity labels** (`enforce`, `warn`, `audit`) to every namespace
- Follow the **principle of least privilege**; only allow elevated permissions where needed
- Gradually roll out enforcement by first enabling **audit** and **warn**
- For custom or advanced policy needs, explore tools like **Kyverno**, **OPA Gatekeeper**, or **Kubewarden**
- Any form of enforcement (built-in or third-party) is better than **doing nothing**

---
